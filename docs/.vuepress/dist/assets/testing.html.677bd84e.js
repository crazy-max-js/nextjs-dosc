import{_ as o,r as p,o as c,c as r,b as n,d as s,e as t,a as e}from"./app.1ad2624e.js";const l={},i=n("h1",{id:"testing",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#testing","aria-hidden":"true"},"#"),s(" Testing")],-1),u={class:"custom-container details"},d=n("summary",null,"示例",-1),k={href:"https://github.com/vercel/next.js/tree/canary/examples/with-cypress",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/vercel/next.js/tree/canary/examples/with-playwright",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/vercel/next.js/tree/canary/examples/with-jest",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/vercel/next.js/tree/canary/examples/with-vitest",target:"_blank",rel:"noopener noreferrer"},y=e('<p>Learn how to set up Next.js with commonly used testing tools:<a href="/docs/testing#cypress">Cypress</a>,<a href="/docs/testing#playwright">Playwright</a>, and<a href="/docs/testing#jest-and-react-testing-library">Jest with React Testing Library</a>.</p><h2 id="cypress" tabindex="-1"><a class="header-anchor" href="#cypress" aria-hidden="true">#</a> Cypress</h2><p>Cypress is a test runner used for<strong>End-to-End (E2E)<strong>and</strong>Integration Testing</strong>.</p><h3 id="quickstart" tabindex="-1"><a class="header-anchor" href="#quickstart" aria-hidden="true">#</a> Quickstart</h3>',4),f=n("code",null,"create-next-app",-1),x={href:"https://github.com/vercel/next.js/tree/canary/examples/with-cypress",target:"_blank",rel:"noopener noreferrer"},b=e(`<div class="language-bash" data-ext="sh"><pre class="language-bash"><code>npx create-next-app@latest <span class="token parameter variable">--example</span> with-cypress with-cypress-app

</code></pre></div><h3 id="manual-setup" tabindex="-1"><a class="header-anchor" href="#manual-setup" aria-hidden="true">#</a> Manual setup</h3><p>To get started with Cypress, install the<code>cypress</code>package:</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev cypress

</code></pre></div><p>Add Cypress to the<code>package.json</code>scripts field:</p><div class="language-json" data-ext="json"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next dev&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next build&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next start&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cypress&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cypress open&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Run Cypress for the first time to generate examples that use their recommended folder structure:</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run cypress

</code></pre></div>`,8),w={href:"https://docs.cypress.io/guides/getting-started/writing-your-first-test",target:"_blank",rel:"noopener noreferrer"},j=e(`<h3 id="creating-your-first-cypress-integration-test" tabindex="-1"><a class="header-anchor" href="#creating-your-first-cypress-integration-test" aria-hidden="true">#</a> Creating your first Cypress integration test</h3><p>Assuming the following two Next.js pages:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// pages/index.js</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">&#39;next/link&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/about<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// pages/about.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">About</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">About Page</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Add a test to check your navigation is working correctly:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// cypress/integration/app.spec.js</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;Navigation&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should navigate to the about page&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Start from the index page</span>
    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:3000/&#39;</span><span class="token punctuation">)</span>

    <span class="token comment">// Find a link with an href attribute containing &quot;about&quot; and click it</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;a[href*=&quot;about&quot;]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// The new url should include &quot;/about&quot;</span>
    cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">&#39;include&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/about&#39;</span><span class="token punctuation">)</span>

    <span class="token comment">// The new page should contain an h1 with &quot;About page&quot;</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&#39;About Page&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>You can use<code>cy.visit(&quot;/&quot;)</code>instead of<code>cy.visit(&quot;http://localhost:3000/&quot;)</code>if you add<code>baseUrl: &#39;http://localhost:3000&#39;</code>to the<code>cypress.config.js</code>configuration file.</p><h3 id="running-your-cypress-tests" tabindex="-1"><a class="header-anchor" href="#running-your-cypress-tests" aria-hidden="true">#</a> Running your Cypress tests</h3><p>Since Cypress is testing a real Next.js application, it requires the Next.js server to be running prior to starting Cypress. We recommend running your tests against your production code to more closely resemble how your application will behave.</p><p>Run<code>npm run build</code>and<code>npm run start</code>, then run<code>npm run cypress</code>in another terminal window to start Cypress.</p><blockquote><p>**Note:**Alternatively, you can install the<code>start-server-and-test</code>package and add it to the<code>package.json</code>scripts field:<code>&quot;test&quot;: &quot;start-server-and-test start http://localhost:3000 cypress&quot;</code>to start the Next.js production server in conjunction with Cypress. Remember to rebuild your application after new changes.</p></blockquote><h3 id="getting-ready-for-continuous-integration-ci" tabindex="-1"><a class="header-anchor" href="#getting-ready-for-continuous-integration-ci" aria-hidden="true">#</a> Getting ready for Continuous Integration (CI)</h3><p>You will have noticed that running Cypress so far has opened an interactive browser which is not ideal for CI environments. You can also run Cypress headlessly using the<code>cypress run</code>command:</p><div class="language-json" data-ext="json"><pre class="language-json"><code><span class="token comment">// package.json</span>

<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token property">&quot;cypress&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cypress open&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cypress:headless&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cypress run&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;e2e&quot;</span><span class="token operator">:</span> <span class="token string">&quot;start-server-and-test start http://localhost:3000 cypress&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;e2e:headless&quot;</span><span class="token operator">:</span> <span class="token string">&quot;start-server-and-test start http://localhost:3000 cypress:headless&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>You can learn more about Cypress and Continuous Integration from these resources:</p>`,15),_={href:"https://docs.cypress.io/guides/continuous-integration/introduction",target:"_blank",rel:"noopener noreferrer"},v={href:"https://on.cypress.io/github-actions",target:"_blank",rel:"noopener noreferrer"},q={href:"https://github.com/cypress-io/github-action",target:"_blank",rel:"noopener noreferrer"},C=n("h2",{id:"playwright",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#playwright","aria-hidden":"true"},"#"),s(" Playwright")],-1),P=n("p",null,[s("Playwright is a testing framework that lets you automate Chromium, Firefox, and WebKit with a single API. You can use it to write"),n("strong",null,[s("End-to-End (E2E)"),n("strong",null,"and"),s("Integration")]),s("tests across all platforms.")],-1),A=n("h3",{id:"quickstart-1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#quickstart-1","aria-hidden":"true"},"#"),s(" Quickstart")],-1),N=n("code",null,"create-next-app",-1),T={href:"https://github.com/vercel/next.js/tree/canary/examples/with-playwright",target:"_blank",rel:"noopener noreferrer"},J=e(`<div class="language-bash" data-ext="sh"><pre class="language-bash"><code>npx create-next-app@latest <span class="token parameter variable">--example</span> with-playwright with-playwright-app

</code></pre></div><h3 id="manual-setup-1" tabindex="-1"><a class="header-anchor" href="#manual-setup-1" aria-hidden="true">#</a> Manual setup</h3><p>You can also use<code>npm init playwright</code>to add Playwright to an existing<code>NPM</code>project.</p><p>To manually get started with Playwright, install the<code>@playwright/test</code>package:</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @playwright/test

</code></pre></div><p>Add Playwright to the<code>package.json</code>scripts field:</p><div class="language-json" data-ext="json"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next dev&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next build&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next start&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;test:e2e&quot;</span><span class="token operator">:</span> <span class="token string">&quot;playwright test&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="creating-your-first-playwright-end-to-end-test" tabindex="-1"><a class="header-anchor" href="#creating-your-first-playwright-end-to-end-test" aria-hidden="true">#</a> Creating your first Playwright end-to-end test</h3><p>Assuming the following two Next.js pages:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// pages/index.js</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">&#39;next/link&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/about<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">About</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// pages/about.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">About</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">About Page</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Add a test to verify that your navigation is working correctly:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// e2e/example.spec.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> test<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@playwright/test&#39;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;should navigate to the about page&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> page <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Start from the index page (the baseURL is set via the webServer in the playwright.config.ts)</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:3000/&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// Find an element with the text &#39;About Page&#39; and click on it</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">&#39;text=About&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// The new URL should be &quot;/about&quot; (baseURL is used there)</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveURL</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:3000/about&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// The new page should contain an h1 with &quot;About Page&quot;</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContainText</span><span class="token punctuation">(</span><span class="token string">&#39;About Page&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div>`,13),I=n("code",null,'page.goto("/")',-1),D=n("code",null,'page.goto("http://localhost:3000/")',-1),R={href:"https://playwright.dev/docs/api/class-testoptions#test-options-base-url",target:"_blank",rel:"noopener noreferrer"},S=n("code",null,'"baseURL": "http://localhost:3000"',-1),L=n("code",null,"playwright.config.ts",-1),E=n("h3",{id:"running-your-playwright-tests",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#running-your-playwright-tests","aria-hidden":"true"},"#"),s(" Running your Playwright tests")],-1),H=n("p",null,"Since Playwright is testing a real Next.js application, it requires the Next.js server to be running prior to starting Playwright. It is recommended to run your tests against your production code to more closely resemble how your application will behave.",-1),F=n("p",null,[s("Run"),n("code",null,"npm run build"),s("and"),n("code",null,"npm run start"),s(", then run"),n("code",null,"npm run test:e2e"),s("in another terminal window to run the Playwright tests.")],-1),M={href:"https://playwright.dev/docs/test-advanced#launching-a-development-web-server-during-the-tests",target:"_blank",rel:"noopener noreferrer"},Y=n("code",null,"webServer",-1),U=n("h3",{id:"running-playwright-on-continuous-integration-ci",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#running-playwright-on-continuous-integration-ci","aria-hidden":"true"},"#"),s(" Running Playwright on Continuous Integration (CI)")],-1),B={href:"https://playwright.dev/docs/ci#running-headed",target:"_blank",rel:"noopener noreferrer"},$=n("code",null,"npx playwright install-deps",-1),V=n("p",null,"You can learn more about Playwright and Continuous Integration from these resources:",-1),W={href:"https://playwright.dev/docs/intro",target:"_blank",rel:"noopener noreferrer"},G={href:"https://playwright.dev/docs/test-advanced#launching-a-development-web-server-during-the-tests",target:"_blank",rel:"noopener noreferrer"},O={href:"https://playwright.dev/docs/ci",target:"_blank",rel:"noopener noreferrer"},Q=e('<h2 id="jest-and-react-testing-library" tabindex="-1"><a class="header-anchor" href="#jest-and-react-testing-library" aria-hidden="true">#</a> Jest and React Testing Library</h2><p>Jest and React Testing Library are frequently used together for<strong>Unit Testing</strong>. There are three ways you can start using Jest within your Next.js application:</p><ul><li>Using one of our<a href="/docs/testing#quickstart-2">quickstart examples</a>- With the<a href="/docs/testing#setting-up-jest-with-the-rust-compiler">Next.js Rust Compiler</a>- With<a href="/docs/testing#setting-up-jest-with-babel">Babel</a></li></ul><p>The following sections will go through how you can set up Jest with each of these options:</p><h3 id="quickstart-2" tabindex="-1"><a class="header-anchor" href="#quickstart-2" aria-hidden="true">#</a> Quickstart</h3>',5),z=n("code",null,"create-next-app",-1),K={href:"https://github.com/vercel/next.js/tree/canary/examples/with-jest",target:"_blank",rel:"noopener noreferrer"},X=e(`<div class="language-bash" data-ext="sh"><pre class="language-bash"><code>npx create-next-app@latest <span class="token parameter variable">--example</span> with-jest with-jest-app

</code></pre></div><h3 id="setting-up-jest-with-the-rust-compiler" tabindex="-1"><a class="header-anchor" href="#setting-up-jest-with-the-rust-compiler" aria-hidden="true">#</a> Setting up Jest (with the Rust Compiler)</h3><p>Since the release of<a href="/blog/next-12">Next.js 12</a>, Next.js now has built-in configuration for Jest.</p><p>To set up Jest, install<code>jest</code>,<code>jest-environment-jsdom</code>,<code>@testing-library/react</code>,<code>@testing-library/jest-dom</code>:</p><div class="language-bash" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest jest-environment-jsdom @testing-library/react @testing-library/jest-dom

</code></pre></div><p>Create a<code>jest.config.js</code>file in your project&#39;s root directory and add the following:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// jest.config.js</span>
<span class="token keyword">const</span> nextJest <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;next/jest&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> createJestConfig <span class="token operator">=</span> <span class="token function">nextJest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// Provide the path to your Next.js app to load next.config.js and .env files in your test environment</span>
  <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">&#39;./&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Add any custom config to be passed to Jest</span>
<span class="token comment">/** @type {import(&#39;jest&#39;).Config} */</span>
<span class="token keyword">const</span> customJestConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// Add more setup options before each test is run</span>
  <span class="token comment">// setupFilesAfterEnv: [&#39;&lt;rootDir&gt;/jest.setup.js&#39;],</span>
  <span class="token comment">// if using TypeScript with a baseUrl set to the root directory then you need the below for alias&#39; to work</span>
  <span class="token literal-property property">moduleDirectories</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&lt;rootDir&gt;/&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">&#39;jest-environment-jsdom&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">createJestConfig</span><span class="token punctuation">(</span>customJestConfig<span class="token punctuation">)</span>

</code></pre></div><p>Under the hood,<code>next/jest</code>is automatically configuring Jest for you, including:</p><ul><li>Setting up<code>transform</code>using<a href="/docs/guide/advanced-features/compiler">SWC</a>- Auto mocking stylesheets (<code>.css</code>,<code>.module.css</code>, and their scss variants), image imports and<a href="/docs/guide/basic-features/font-optimization"><code>@next/font</code></a>- Loading<code>.env</code>(and all variants) into<code>p<wbr>rocess.env</code>- Ignoring<code>node_modules</code>from test resolving and transforms- Ignoring<code>.next</code>from test resolving- Loading<code>next.config.js</code>for flags that enable SWC transforms</li></ul><blockquote><p><strong>Note</strong>: To test environment variables directly, load them manually in a separate setup script or in your<code>jest.config.js</code>file. For more information, please see<a href="/docs/guide/basic-features/environment-variables#test-environment-variables">Test Environment Variables</a>.</p></blockquote><h3 id="setting-up-jest-with-babel" tabindex="-1"><a class="header-anchor" href="#setting-up-jest-with-babel" aria-hidden="true">#</a> Setting up Jest (with Babel)</h3><p>If you opt out of the<a href="/docs/guide/advanced-features/compiler">Rust Compiler</a>, you will need to manually configure Jest and install<code>babel-jest</code>and<code>identity-obj-proxy</code>in addition to the packages above.</p><p>Here are the recommended options to configure Jest for Next.js:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// jest.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">collectCoverage</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// on node 14.x coverage provider v8 offers good speed and more or less good report</span>
  <span class="token literal-property property">coverageProvider</span><span class="token operator">:</span> <span class="token string">&#39;v8&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">collectCoverageFrom</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;**/*.{js,jsx,ts,tsx}&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;!**/*.d.ts&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;!**/node_modules/**&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;!&lt;rootDir&gt;/out/**&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;!&lt;rootDir&gt;/.next/**&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;!&lt;rootDir&gt;/*.config.js&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;!&lt;rootDir&gt;/coverage/**&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">moduleNameMapper</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle CSS imports (with CSS modules)</span>
    <span class="token comment">// https://jestjs.io/docs/webpack#mocking-css-modules</span>
    <span class="token string-property property">&#39;^.+\\\\.module\\\\.(css|sass|scss)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;identity-obj-proxy&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">// Handle CSS imports (without CSS modules)</span>
    <span class="token string-property property">&#39;^.+\\\\.(css|sass|scss)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/__mocks__/styleMock.js&#39;</span><span class="token punctuation">,</span>

    <span class="token comment">// Handle image imports</span>
    <span class="token comment">// https://jestjs.io/docs/webpack#handling-static-assets</span>
    <span class="token string-property property">&#39;^.+\\\\.(png|jpg|jpeg|gif|webp|avif|ico|bmp|svg)$/i&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;rootDir&gt;/__mocks__/fileMock.js</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>

    <span class="token comment">// Handle module aliases</span>
    <span class="token string-property property">&#39;^@/components/(.*)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/components/$1&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Add more setup options before each test is run</span>
  <span class="token comment">// setupFilesAfterEnv: [&#39;&lt;rootDir&gt;/jest.setup.js&#39;],</span>
  <span class="token literal-property property">testPathIgnorePatterns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;&lt;rootDir&gt;/node_modules/&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&lt;rootDir&gt;/.next/&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">&#39;jsdom&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Use babel-jest to transpile tests with the next/babel preset</span>
    <span class="token comment">// https://jestjs.io/docs/configuration#transform-objectstring-pathtotransformer--pathtotransformer-object</span>
    <span class="token string-property property">&#39;^.+\\\\.(js|jsx|ts|tsx)$&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;babel-jest&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;next/babel&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transformIgnorePatterns</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;/node_modules/&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;^.+\\\\.module\\\\.(css|sass|scss)$&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div>`,14),Z={href:"https://jestjs.io/docs/configuration",target:"_blank",rel:"noopener noreferrer"},nn=e(`<p><strong>Handling stylesheets and image imports</strong></p><p>Stylesheets and images aren&#39;t used in the tests but importing them may cause errors, so they will need to be mocked. Create the mock files referenced in the configuration above -<code>fileMock.js</code>and<code>styleMock.js</code>- inside a<code>__mocks__</code>directory:</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// __mocks__/fileMock.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">&#39;/img.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
  <span class="token literal-property property">blurDataURL</span><span class="token operator">:</span> <span class="token string">&#39;data:image/png;base64,imagedata&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// __mocks__/styleMock.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div>`,4),sn={href:"https://jestjs.io/docs/webpack#handling-static-assets",target:"_blank",rel:"noopener noreferrer"},an=n("p",null,[n("strong",null,"Optional: Extend Jest with custom matchers")],-1),tn=n("code",null,"@testing-library/jest-dom",-1),en={href:"https://github.com/testing-library/jest-dom#custom-matchers",target:"_blank",rel:"noopener noreferrer"},on=n("code",null,".toBeInTheDocument()",-1),pn=e(`<div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// jest.config.js</span>
<span class="token literal-property property">setupFilesAfterEnv</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;&lt;rootDir&gt;/jest.setup.js&#39;</span><span class="token punctuation">]</span>

</code></pre></div><p>Then, inside<code>jest.setup.js</code>, add the following import:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// jest.setup.js</span>
<span class="token keyword">import</span> <span class="token string">&#39;@testing-library/jest-dom/extend-expect&#39;</span>

</code></pre></div><p>If you need to add more setup options before each test, it&#39;s common to add them to the<code>jest.setup.js</code>file above.</p><p><strong>Optional: Absolute Imports and Module Path Aliases</strong></p><p>If your project is using<a href="/docs/guide/advanced-features/module-path-aliases">Module Path Aliases</a>, you will need to configure Jest to resolve the imports by matching the paths option in the<code>jsconfig.json</code>file with the<code>moduleNameMapper</code>option in the<code>jest.config.js</code>file. For example:</p><div class="language-json" data-ext="json"><pre class="language-json"><code><span class="token comment">// tsconfig.json or jsconfig.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;@/components/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;components/*&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// jest.config.js</span>
<span class="token literal-property property">moduleNameMapper</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&#39;^@/components/(.*)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/components/$1&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="creating-your-tests" tabindex="-1"><a class="header-anchor" href="#creating-your-tests" aria-hidden="true">#</a> Creating your tests:</h3><p><strong>Add a test script to package.json</strong></p><p>Add the Jest executable in watch mode to the<code>package.json</code>scripts:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next dev&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next build&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next start&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --watch&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div>`,12),cn=n("code",null,"jest --watch",-1),rn={href:"https://jestjs.io/docs/cli#reference",target:"_blank",rel:"noopener noreferrer"},ln=e(`<p><strong>Create your first tests</strong></p><p>Your project is now ready to run tests. Follow Jest&#39;s convention by adding tests to the<code>__tests__</code>folder in your project&#39;s root directory.</p><p>For example, we can add a test to check if the<code>&lt;Home /&gt;</code>component successfully renders a heading:</p><div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// __tests__/index.test.jsx</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@testing-library/react&#39;</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">&#39;../pages/index&#39;</span>
<span class="token keyword">import</span> <span class="token string">&#39;@testing-library/jest-dom&#39;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;Home&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;renders a heading&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> heading <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">&#39;heading&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">welcome to next\\.js!</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>heading<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div>`,4),un={href:"https://jestjs.io/docs/snapshot-testing",target:"_blank",rel:"noopener noreferrer"},dn=n("code",null,"<Home />",-1),kn=e(`<div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// __tests__/snapshot.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@testing-library/react&#39;</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">&#39;../pages/index&#39;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;renders homepage unchanged&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><blockquote><p><strong>Note</strong>: Test files should not be included inside the pages directory because any files inside the pages directory are considered routes.</p></blockquote><p><strong>Running your test suite</strong></p><p>Run<code>npm run test</code>to run your test suite. After your tests pass or fail, you will notice a list of interactive Jest commands that will be helpful as you add more tests.</p><p>For further reading, you may find these resources helpful:</p>`,5),gn={href:"https://jestjs.io/docs/getting-started",target:"_blank",rel:"noopener noreferrer"},hn={href:"https://testing-library.com/docs/react-testing-library/intro/",target:"_blank",rel:"noopener noreferrer"},mn={href:"https://testing-playground.com/",target:"_blank",rel:"noopener noreferrer"},yn=n("h2",{id:"community-packages-and-examples",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#community-packages-and-examples","aria-hidden":"true"},"#"),s(" Community Packages and Examples")],-1),fn=n("p",null,"The Next.js community has created packages and articles you may find helpful:",-1),xn={href:"https://github.com/scottrippey/next-router-mock",target:"_blank",rel:"noopener noreferrer"},bn={href:"https://glebbahmutov.com/blog/develop-preview-test/",target:"_blank",rel:"noopener noreferrer"},wn=n("p",null,"For more information on what to read next, we recommend:",-1);function jn(_n,vn){const a=p("ExternalLinkIcon");return c(),r("div",null,[i,n("details",u,[d,n("ul",null,[n("li",null,[n("a",k,[s("Next.js with Cypress"),t(a)]),s("- "),n("a",g,[s("Next.js with Playwright"),t(a)]),s("- "),n("a",h,[s("Next.js with Jest and React Testing Library"),t(a)]),s("- "),n("a",m,[s("Next.js with Vitest"),t(a)])])])]),y,n("p",null,[s("You can use"),f,s("with the"),n("a",x,[s("with-cypress example"),t(a)]),s("to quickly get started.")]),b,n("p",null,[s("You can look through the generated examples and the"),n("a",w,[s("Writing Your First Test"),t(a)]),s("section of the Cypress Documentation to help you get familiar with Cypress.")]),j,n("ul",null,[n("li",null,[n("a",_,[s("Cypress Continuous Integration Docs"),t(a)]),s("- "),n("a",v,[s("Cypress GitHub Actions Guide"),t(a)]),s("- "),n("a",q,[s("Official Cypress GitHub Action"),t(a)])])]),C,P,A,n("p",null,[s("The fastest way to get started is to use"),N,s("with the"),n("a",T,[s("with-playwright example"),t(a)]),s(". This will create a Next.js project complete with Playwright all set up.")]),J,n("p",null,[s("You can use"),I,s("instead of"),D,s(", if you add"),n("a",R,[S,t(a)]),s("to the"),L,s("configuration file.")]),E,H,F,n("blockquote",null,[n("p",null,[s("**Note:**Alternatively, you can use the"),n("a",M,[Y,t(a)]),s("feature to let Playwright start the development server and wait until it's fully available.")])]),U,n("p",null,[s("Playwright will by default run your tests in the"),n("a",B,[s("headless mode"),t(a)]),s(". To install all the Playwright dependencies, run"),$,s(".")]),V,n("ul",null,[n("li",null,[n("a",W,[s("Getting started with Playwright"),t(a)]),s("- "),n("a",G,[s("Use a development server"),t(a)]),s("- "),n("a",O,[s("Playwright on your CI provider"),t(a)])])]),Q,n("p",null,[s("You can use"),z,s("with the"),n("a",K,[s("with-jest"),t(a)]),s("example to quickly get started with Jest and React Testing Library:")]),X,n("p",null,[s("You can learn more about each configuration option in the"),n("a",Z,[s("Jest docs"),t(a)]),s(".")]),nn,n("p",null,[s("For more information on handling static assets, please refer to the"),n("a",sn,[s("Jest Docs"),t(a)]),s(".")]),an,n("p",null,[tn,s("includes a set of convenient"),n("a",en,[s("custom matchers"),t(a)]),s("such as"),on,s("making it easier to write tests. You can import the custom matchers for every test by adding the following option to the Jest configuration file:")]),pn,n("p",null,[cn,s("will re-run tests when a file is changed. For more Jest CLI options, please refer to the"),n("a",rn,[s("Jest Docs"),t(a)]),s(".")]),ln,n("p",null,[s("Optionally, add a"),n("a",un,[s("snapshot test"),t(a)]),s("to keep track of any unexpected changes to your"),dn,s("component:")]),kn,n("ul",null,[n("li",null,[n("a",gn,[s("Jest Docs"),t(a)]),s("- "),n("a",hn,[s("React Testing Library Docs"),t(a)]),s("- "),n("a",mn,[s("Testing Playground"),t(a)]),s("- use good testing practices to match elements.")])]),yn,fn,n("ul",null,[n("li",null,[n("a",xn,[s("next-router-mock"),t(a)]),s("for Storybook.- "),n("a",bn,[s("Test Preview Vercel Deploys with Cypress"),t(a)]),s("by Gleb Bahmutov.")])]),wn])}const Cn=o(l,[["render",jn],["__file","testing.html.vue"]]);export{Cn as default};
