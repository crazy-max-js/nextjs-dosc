import{_ as s,r,o as i,c,b as e,d as t,e as o,a}from"./app.1ad2624e.js";const l={},d=e("h1",{id:"going-to-production",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#going-to-production","aria-hidden":"true"},"#"),t(" Going to Production")],-1),u=e("p",null,"Before taking your Next.js application to production, here are some recommendations to ensure the best user experience.",-1),h=e("h2",{id:"in-general",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#in-general","aria-hidden":"true"},"#"),t(" In General")],-1),p=e("a",{href:"#caching"},"caching",-1),g=e("a",{href:"#logging"},"logging",-1),m=e("a",{href:"#error-handling"},"error handling",-1),f=e("a",{href:"/docs/guide/advanced-features/custom-error-page#404-page"},"404",-1),_=e("a",{href:"/docs/guide/advanced-features/custom-error-page#500-page"},"500",-1),b=e("a",{href:"/docs/guide/advanced-features/measuring-performance"},"measuring performance",-1),y={href:"https://developers.google.com/web/tools/lighthouse",target:"_blank",rel:"noopener noreferrer"},v=e("a",{href:"/docs/guide/basic-features/supported-browsers-features"},"Supported Browsers and Features",-1),w=e("a",{href:"/docs/guide/basic-features/image-optimization"},[e("code",null,"next/image"),t("and Automatic Image Optimization")],-1),k=e("a",{href:"/docs/guide/basic-features/font-optimization"},"Automatic Font Optimization",-1),x=e("a",{href:"/docs/guide/basic-features/script"},"Script Optimization",-1),S=e("a",{href:"#loading-performance"},"loading performance",-1),I=e("h2",{id:"caching",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#caching","aria-hidden":"true"},"#"),t(" Caching")],-1),C={class:"custom-container details"},z=e("summary",null,"示例",-1),j={href:"https://github.com/vercel/next.js/tree/canary/examples/ssr-caching",target:"_blank",rel:"noopener noreferrer"},P=a(`<p>Caching improves response times and reduces the number of requests to external services. Next.js automatically adds caching headers to immutable assets served from<code>/_next/static</code>including JavaScript, CSS, static images, and other media.</p><div class="language-text" data-ext="text"><pre class="language-text"><code>Cache-Control: public, max-age=31536000, immutable

</code></pre></div><p><code>Cache-Control</code>headers set in<code>next.config.js</code>will be overwritten in production to ensure that static assets can be cached effectively. If you need to revalidate the cache of a page that has been<a href="/docs/guide/basic-features/pages#static-generation-recommended">statically generated</a>, you can do so by setting<code>revalidate</code>in the page&#39;s<a href="/docs/guide/basic-features/data-fetching/get-static-props"><code>getStaticProps</code></a>function. If you&#39;re using<code>next/image</code>, there are also<a href="/docs/guide/basic-features/image-optimization#caching">specific caching rules</a>for the default Image Optimization loader.</p><p>**Note:**When running your application locally with<code>next dev</code>, your headers are overwritten to prevent caching locally.</p><div class="language-text" data-ext="text"><pre class="language-text"><code>Cache-Control: no-cache, no-store, max-age=0, must-revalidate

</code></pre></div>`,5),E=e("code",null,"getServerSideProps",-1),N={href:"https://web.dev/stale-while-revalidate/",target:"_blank",rel:"noopener noreferrer"},V=e("code",null,"stale-while-revalidate",-1),A=a(`<div class="language-jsx" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// This value is considered fresh for ten seconds (s-maxage=10).</span>
<span class="token comment">// If a request is repeated within the next 10 seconds, the previously</span>
<span class="token comment">// cached value will still be fresh. If the request is repeated before 59 seconds,</span>
<span class="token comment">// the cached value will be stale but still render (stale-while-revalidate=59).</span>
<span class="token comment">//</span>
<span class="token comment">// In the background, a revalidation request will be made to populate the cache</span>
<span class="token comment">// with a fresh value. If you refresh the page, you will see the new value.</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> req<span class="token punctuation">,</span> res <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>
    <span class="token string">&#39;Cache-Control&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;public, s-maxage=10, stale-while-revalidate=59&#39;</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>By default,<code>Cache-Control</code>headers will be set differently depending on how your page fetches data.</p><ul><li>If the page uses<code>getServerSideProps</code>or<code>getInitialProps</code>, it will use the default<code>Cache-Control</code>header set by<code>next start</code>in order to prevent accidental caching of responses that cannot be cached. If you want a different cache behavior while using<code>getServerSideProps</code>, use<code>res.setHeader(&#39;Cache-Control&#39;, &#39;value_you_prefer&#39;)</code>inside of the function as shown above.- If the page is using<code>getStaticProps</code>, it will have a<code>Cache-Control</code>header of<code>s-maxage=REVALIDATE_SECONDS, stale-while-revalidate</code>, or if<code>revalidate</code>isnotused,<code>s-maxage=31536000, stale-while-revalidate</code>to cache for the maximum age possible.</li></ul>`,3),R={href:"https://vercel.com/docs/edge-network/caching?utm_source=next-site&utm_medium=docs&utm_campaign=next-website",target:"_blank",rel:"noopener noreferrer"},F=e("h2",{id:"reducing-javascript-size",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#reducing-javascript-size","aria-hidden":"true"},"#"),t(" Reducing JavaScript Size")],-1),B={class:"custom-container details"},T=e("summary",null,"示例",-1),q={href:"https://github.com/vercel/next.js/tree/canary/examples/with-dynamic-import",target:"_blank",rel:"noopener noreferrer"},J=e("p",null,"To reduce the amount of JavaScript sent to the browser, you can use the following tools to understand what is included inside each JavaScript bundle:",-1),L={href:"https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost",target:"_blank",rel:"noopener noreferrer"},D={href:"https://packagephobia.com/",target:"_blank",rel:"noopener noreferrer"},O={href:"https://bundlephobia.com/",target:"_blank",rel:"noopener noreferrer"},W={href:"https://github.com/vercel/next.js/tree/canary/packages/next-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"},Y={href:"https://bundlejs.com/",target:"_blank",rel:"noopener noreferrer"},H=e("p",null,[t("Each file inside your"),e("code",null,"pages/"),t("directory will automatically be code split into its own JavaScript bundle during"),e("code",null,"next build"),t(". You can also use"),e("a",{href:"/docs/guide/advanced-features/dynamic-import"},"Dynamic Imports"),t("to lazy-load components and libraries. For example, you might want to defer loading your modal code until a user clicks the open button.")],-1),U=e("h2",{id:"logging",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#logging","aria-hidden":"true"},"#"),t(" Logging")],-1),G={class:"custom-container details"},K=e("summary",null,"示例",-1),M={href:"https://github.com/Logflare/next-pino-logflare-logging-example",target:"_blank",rel:"noopener noreferrer"},Q=e("p",null,"Since Next.js runs on both the client and server, there are multiple forms of logging supported:",-1),X=e("ul",null,[e("li",null,[e("code",null,"console.log"),t("in the browser- "),e("code",null,"stdout"),t("on the server")])],-1),Z={href:"https://www.npmjs.com/package/pino",target:"_blank",rel:"noopener noreferrer"},$={href:"https://vercel.com/integrations#logging?utm_source=next-site&utm_medium=docs&utm_campaign=next-website",target:"_blank",rel:"noopener noreferrer"},ee=e("h2",{id:"error-handling",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#error-handling","aria-hidden":"true"},"#"),t(" Error Handling")],-1),te={class:"custom-container details"},ne=e("summary",null,"示例",-1),oe={href:"https://github.com/vercel/next.js/tree/canary/examples/with-sentry",target:"_blank",rel:"noopener noreferrer"},ae=e("p",null,[t("When an unhandled exception occurs, you can control the experience for your users with the"),e("a",{href:"/docs/guide/advanced-features/custom-error-page#500-page"},"500 page"),t(". We recommend customizing this to your brand instead of the default Next.js theme.")],-1),se={href:"https://github.com/vercel/next.js/tree/canary/examples/with-sentry",target:"_blank",rel:"noopener noreferrer"},re={href:"https://vercel.com/integrations/sentry?utm_source=next-site&utm_medium=docs&utm_campaign=next-website",target:"_blank",rel:"noopener noreferrer"},ie=e("h2",{id:"loading-performance",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#loading-performance","aria-hidden":"true"},"#"),t(" Loading Performance")],-1),ce={href:"https://vercel.com/blog/core-web-vitals?utm_source=next-site&utm_medium=docs&utm_campaign=next-website",target:"_blank",rel:"noopener noreferrer"},le={href:"https://vercel.com/blog/core-web-vitals?utm_source=next-site&utm_medium=docs&utm_campaign=next-website",target:"_blank",rel:"noopener noreferrer"},de=e("ul",null,[e("li",null,"In the lab, using your own computer or a simulator.- In the field, using real-world data from actual visitors.- Local, using a test that runs on your device.- Remote, using a test that runs in the cloud.")],-1),ue=e("p",null,"Once you are able to measure the loading performance, use the following strategies to improve it iteratively so that you apply one strategy, measure the new performance and continue tweaking until you do not see much improvement. Then, you can move on to the next strategy.",-1),he=e("a",{href:"#caching"},"caching",-1),pe=e("code",null,"stale-while-revalidate",-1),ge=e("a",{href:"/docs/guide/basic-features/data-fetching#incremental-static-regeneration"},"Incremental Static Regeneration",-1),me={href:"https://calibreapp.com/blog/bundle-size-optimization",target:"_blank",rel:"noopener noreferrer"},fe={href:"https://papyrus.dev/@PapyrusBlog/how-we-reduced-next.js-page-size-by-3.5x-and-achieved-a-98-lighthouse-score",target:"_blank",rel:"noopener noreferrer"},_e={href:"https://dev.to/endymion1818/nextjs-performance-checklist-5gjb",target:"_blank",rel:"noopener noreferrer"},be=e("h2",{id:"related",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#related","aria-hidden":"true"},"#"),t(" Related")],-1),ye=e("p",null,"For more information on what to do next, we recommend the following sections:",-1);function ve(we,ke){const n=r("ExternalLinkIcon");return i(),c("div",null,[d,u,h,e("ul",null,[e("li",null,[t("Use"),p,t("wherever possible.- Ensure your database and backend are deployed in the same region.- Aim to ship the least amount of JavaScript possible.- Defer loading heavy JavaScript bundles until needed.- Ensure"),g,t("is set up.- Ensure"),m,t("is set up.- Configure the"),f,t("(Not Found) and"),_,t("(Error) pages.- Ensure you are"),b,t(".- Run"),e("a",y,[t("Lighthouse"),o(n)]),t("to check for performance, best practices, accessibility, and SEO. For best results, use a production build of Next.js and use incognito in your browser so results aren't affected by extensions.- Review"),v,t(".- Improve performance using:- "),w,t("- "),k,t("- "),x,t("- Improve"),S])]),I,e("details",C,[z,e("ul",null,[e("li",null,[e("a",j,[t("ssr-caching"),o(n)])])])]),P,e("p",null,[t("You can also use caching headers inside"),E,t("and API Routes for dynamic responses. For example, using"),e("a",N,[V,o(n)]),t(".")]),A,e("blockquote",null,[e("p",null,[t("**Note:**Your deployment provider must support caching for dynamic responses. If you are self-hosting, you will need to add this logic yourself using a key/value store like Redis. If you are using Vercel,"),e("a",R,[t("Edge Caching works without configuration"),o(n)]),t(".")])]),F,e("details",B,[T,e("ul",null,[e("li",null,[e("a",q,[t("with-dynamic-import"),o(n)])])])]),J,e("ul",null,[e("li",null,[e("a",L,[t("Import Cost"),o(n)]),t("– Display the size of the imported package inside VSCode.- "),e("a",D,[t("Package Phobia"),o(n)]),t("– Find the cost of adding a new dev dependency to your project.- "),e("a",O,[t("Bundle Phobia"),o(n)]),t("- Analyze how much a dependency can increase bundle sizes.- "),e("a",W,[t("Webpack Bundle Analyzer"),o(n)]),t("– Visualize the size of webpack output files with an interactive, zoomable treemap.- "),e("a",Y,[t("bundlejs"),o(n)]),t("- An online tool to quickly bundle & minify your projects, while viewing the compressed gzip/brotli bundle size, all running locally on your browser.")])]),H,U,e("details",G,[K,e("ul",null,[e("li",null,[e("a",M,[t("with-logging"),o(n)])])])]),Q,X,e("p",null,[t("If you want a structured logging package, we recommend"),e("a",Z,[t("Pino"),o(n)]),t(". If you're using Vercel, there are"),e("a",$,[t("pre-built logging integrations"),o(n)]),t("compatible with Next.js.")]),ee,e("details",te,[ne,e("ul",null,[e("li",null,[e("a",oe,[t("with-sentry"),o(n)])])])]),ae,e("p",null,[t("You can also log and track exceptions with a tool like Sentry."),e("a",se,[t("This example"),o(n)]),t("shows how to catch & report errors on both the client and server-side, using the Sentry SDK for Next.js. There's also a"),e("a",re,[t("Sentry integration for Vercel"),o(n)]),t(".")]),ie,e("p",null,[t("To improve loading performance, you first need to determine what to measure and how to measure it."),e("a",ce,[t("Core Web Vitals"),o(n)]),t("is a good industry standard that is measured using your own web browser. If you are not familiar with the metrics of Core Web Vitals, review this"),e("a",le,[t("blog post"),o(n)]),t("and determine which specific metric/s will be your drivers for loading performance. Ideally, you would want to measure the loading performance in the following environments:")]),de,ue,e("ul",null,[e("li",null,[t("Use caching regions that are close to the regions where your database or API is deployed.- As described in the"),he,t("section, use a"),pe,t("value that will not overload your backend.- Use"),ge,t("to reduce the number of requests to your backend.- Remove unused JavaScript. Review this"),e("a",me,[t("blog post"),o(n)]),t("to understand what Core Web Vitals metrics bundle size affects and what strategies you can use to reduce it, such as:- Setting up your Code Editor to view import costs and sizes- Finding alternative smaller packages- Dynamically loading components and dependencies- For more in-depth information, review this"),e("a",fe,[t("guide"),o(n)]),t("and this"),e("a",_e,[t("performance checklist"),o(n)]),t(".")])]),be,ye])}const Se=s(l,[["render",ve],["__file","going-to-production.html.vue"]]);export{Se as default};
